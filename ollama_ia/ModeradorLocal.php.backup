    private $palabras_prohibidas = [
        // Groserías comunes
        'puto', 'puta', 'pendejo', 'pendeja', 'cabrón', 'cabrona',
        'chingar', 'verga', 'mierda', 'coño', 'joder',
        
        // Spam y publicidad
        'viagra', 'casino', 'poker', 'apuestas', 'ganar dinero fácil',
        'haz clic aquí', 'compra ahora', 'oferta limitada',
        
        // Contenido inapropiado
        'porno', 'xxx', 'sexo gratis', 'desnudo',
        
        // Agrega más según tus necesidades
    ];
    
    // Palabras que indican contenido académico de calidad
    private $palabras_academicas = [
        'investigación', 'estudio', 'análisis', 'metodología',
        'resultados', 'conclusión', 'hipótesis', 'experimento',
        'teoría', 'evidencia', 'datos', 'muestra', 'bibliografía',
        'referencias', 'abstract', 'resumen', 'objetivo'
    ];
    
    /**
     * CONSTRUCTOR
     */
    public function __construct($conexion_bd) {
        $this->conn = $conexion_bd;
    }
    
    /**
     * MÉTODO PRINCIPAL: analizarPublicacion
     * Analiza una publicación y decide si aprobarla o rechazarla
     */
    public function analizarPublicacion($publicacion_id) {
        // Obtener los datos de la publicación
        $publicacion = $this->obtenerPublicacion($publicacion_id);
        
        if (!$publicacion) {
            return [
                'success' => false,
                'error' => 'Publicación no encontrada'
            ];
        }
        
        // Inicializar puntuación
        $puntuacion = 100; // Empezamos con 100 puntos
        $razones = [];
        
        // VALIDACIÓN 1: Verificar longitud mínima
        $longitud = strlen($publicacion['contenido']);
        if ($longitud < 100) {
            $decision = 'rechazada';
            $razon = "El contenido es muy corto ({$longitud} caracteres). Mínimo requerido: 100";
            $puntuacion = 0;
            
            // Guardar el análisis
            $this->guardarAnalisis($publicacion_id, $decision, $razon, $puntuacion);
            
            // Actualizar el estado de la publicación
            $this->actualizarEstadoPublicacion($publicacion_id, $decision, $razon);
            
            return [
                'success' => true,
                'decision' => $decision,
                'razon' => $razon,
                'confianza' => 100,
                'tipo_analisis' => 'validacion_local'
            ];
        }
        
        // VALIDACIÓN 2: Buscar palabras prohibidas
        $palabras_encontradas = $this->buscarPalabrasProhibidas($publicacion);
        if (!empty($palabras_encontradas)) {
            $lista = implode(', ', $palabras_encontradas);
            $decision = 'rechazada';
            $razon = "Contiene palabras prohibidas: {$lista}";
            $puntuacion = 0;
            
            // Guardar el análisis
            $this->guardarAnalisis($publicacion_id, $decision, $razon, $puntuacion);
            
            // Actualizar el estado de la publicación
            $this->actualizarEstadoPublicacion($publicacion_id, $decision, $razon);
            
            return [
                'success' => true,
                'decision' => $decision,
                'razon' => $razon,
                'confianza' => 100,
                'tipo_analisis' => 'validacion_local'
            ];
        }
        
        // VALIDACIÓN 3: Verificar calidad del contenido
        $analisis_calidad = $this->analizarCalidad($publicacion);
        $puntuacion = $analisis_calidad['puntuacion'];
        $razones = $analisis_calidad['razones'];
        
        // DECISIÓN FINAL
        if ($puntuacion >= 70) {
            $decision = 'publicado';
            $razon = "Publicación aprobada. " . implode('. ', $razones);
        } else if ($puntuacion >= 50) {
            $decision = 'en_revision';
            $razon = "Requiere revisión manual. " . implode('. ', $razones);
        } else {
            $decision = 'rechazada';
            $razon = "Publicación rechazada. " . implode('. ', $razones);
        }
        
        // Guardar el análisis
        $this->guardarAnalisis($publicacion_id, $decision, $razon, $puntuacion);
        
        // Actualizar el estado de la publicación
        $this->actualizarEstadoPublicacion($publicacion_id, $decision, $razon);
        
        return [
            'success' => true,
            'decision' => $decision,
            'razon' => $razon,
            'confianza' => $puntuacion,
            'tipo_analisis' => 'moderacion_local'
        ];
    }
    
    /**
     * Buscar palabras prohibidas en el contenido
     */
    private function buscarPalabrasProhibidas($publicacion) {
        $encontradas = [];
        $texto = strtolower($publicacion['titulo'] . ' ' . $publicacion['contenido']);
        
        foreach ($this->palabras_prohibidas as $palabra) {
            if (strpos($texto, strtolower($palabra)) !== false) {
                $encontradas[] = $palabra;
            }
        }
        
        return $encontradas;
    }
    
    /**
     * Analizar la calidad del contenido
     */
    private function analizarCalidad($publicacion) {
        $puntuacion = 100;
        $razones = [];
        
        $titulo = $publicacion['titulo'];
        $contenido = $publicacion['contenido'];
        $texto_completo = strtolower($titulo . ' ' . $contenido);
        
        // 1. Verificar palabras académicas
        $palabras_acad_encontradas = 0;
        foreach ($this->palabras_academicas as $palabra) {
            if (strpos($texto_completo, strtolower($palabra)) !== false) {
                $palabras_acad_encontradas++;
            }
        }
        
        if ($palabras_acad_encontradas >= 3) {
            $razones[] = "Contiene vocabulario académico apropiado";
        } else if ($palabras_acad_encontradas >= 1) {
            $puntuacion -= 10;
            $razones[] = "Vocabulario académico limitado";
        } else {
            $puntuacion -= 20;
            $razones[] = "No contiene vocabulario académico";
        }
        
        // 2. Verificar estructura (párrafos)
        $parrafos = explode("\n", $contenido);
        $parrafos = array_filter($parrafos, function($p) {
            return strlen(trim($p)) > 50;
        });
        
        if (count($parrafos) >= 3) {
            $razones[] = "Bien estructurado en párrafos";
        } else {
            $puntuacion -= 15;
            $razones[] = "Estructura mejorable (pocos párrafos)";
        }
        
        // 3. Verificar longitud del título
        if (strlen($titulo) < 10) {
            $puntuacion -= 10;
            $razones[] = "Título muy corto";
        } else if (strlen($titulo) > 100) {
            $puntuacion -= 5;
            $razones[] = "Título muy largo";
        } else {
            $razones[] = "Título de longitud adecuada";
        }
        
        // 4. Verificar mayúsculas excesivas (SPAM)
        $mayusculas = preg_match_all('/[A-Z]/', $contenido);
        $total_letras = preg_match_all('/[a-zA-Z]/', $contenido);
        
        if ($total_letras > 0) {
            $porcentaje_mayusculas = ($mayusculas / $total_letras) * 100;
            if ($porcentaje_mayusculas > 30) {
                $puntuacion -= 25;
                $razones[] = "Uso excesivo de mayúsculas (posible spam)";
            }
        }
        
        // 5. Verificar signos de exclamación/interrogación excesivos
        $exclamaciones = substr_count($contenido, '!');
        $interrogaciones = substr_count($contenido, '?');
        
        if ($exclamaciones > 5 || $interrogaciones > 10) {
            $puntuacion -= 15;
            $razones[] = "Uso excesivo de signos de puntuación";
        }
        
        // 6. Verificar URLs sospechosas
        if (preg_match_all('/https?:\/\//', $contenido) > 3) {
            $puntuacion -= 20;
            $razones[] = "Contiene múltiples enlaces (posible spam)";
        }
        
        return [
            'puntuacion' => max(0, min(100, $puntuacion)),
            'razones' => $razones
        ];
    }
    
    /**
     * Obtener publicación de la base de datos
     */
    private function obtenerPublicacion($id) {
        $query = "SELECT * FROM publicaciones WHERE id = ?";
        $stmt = $this->conn->prepare($query);
        $stmt->bind_param("i", $id);
        $stmt->execute();
        $resultado = $stmt->get_result();
        
        if ($resultado->num_rows > 0) {
            return $resultado->fetch_assoc();
        }
        
        return null;
    }
    
    /**
     * Guardar análisis en la base de datos
     */
    private function guardarAnalisis($publicacion_id, $decision, $razon, $confianza) {
        $query = "INSERT INTO moderacion_ia_logs 
                  (publicacion_id, decision, razon, confianza, fecha_analisis) 
                  VALUES (?, ?, ?, ?, NOW())";
        
        $stmt = $this->conn->prepare($query);
        $stmt->bind_param("issi", $publicacion_id, $decision, $razon, $confianza);
        $stmt->execute();
    }
    
    /**
     * Actualizar estado de la publicación Y enviar correo al publicador
     */
    private function actualizarEstadoPublicacion($publicacion_id, $nuevo_estado, $razon = null) {
        // Primero obtener datos del publicador antes de actualizar
        $query_pub = "SELECT p.*, pub.nombre as publicador_nombre, pub.email as publicador_email 
                      FROM publicaciones p 
                      INNER JOIN publicadores pub ON p.publicador_id = pub.id 
                      WHERE p.id = ?";
        $stmt = $this->conn->prepare($query_pub);
        $stmt->bind_param("i", $publicacion_id);
        $stmt->execute();
        $resultado = $stmt->get_result();
        $datos = $resultado->fetch_assoc();
        $stmt->close();
        
        // Actualizar el estado en la base de datos
        if ($nuevo_estado === 'rechazada' && $razon !== null) {
            $query = "UPDATE publicaciones SET estado = ?, mensaje_rechazo = ? WHERE id = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("ssi", $nuevo_estado, $razon, $publicacion_id);
        } else {
            $query = "UPDATE publicaciones SET estado = ?, mensaje_rechazo = NULL WHERE id = ?";
            $stmt = $this->conn->prepare($query);
            $stmt->bind_param("si", $nuevo_estado, $publicacion_id);
        }
        
        $stmt->execute();
        $stmt->close();
        
        // Enviar correo electrónico al publicador
        if ($datos && isset($datos['publicador_email'])) {
            $this->enviarCorreoNotificacion(
                $datos['publicador_email'],
                $datos['publicador_nombre'],
                $datos['titulo'],
                $nuevo_estado,
                $razon
            );
            
            // También notificar a los administradores
            $this->notificarAdministradores($datos, $nuevo_estado, $razon);
        }
    }
    
    /**
     * Notificar a todos los administradores sobre la decisión de moderación
     */
    private function notificarAdministradores($datos_publicacion, $estado, $razon = null) {
        // Obtener todos los correos de administradores
        $query = "SELECT email, nombre FROM admins";
        $mail->Username = 'lab.explorer2025@gmail.com';
        $mail->Password = 'yero ewft jacf vjzp';
        $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;
        $mail->Port = 587;
        
        // Configuración de codificación
        $mail->CharSet = 'UTF-8';
        $mail->Encoding = 'base64';
        
        // Remitente
        $mail->setFrom('lab.explorer2025@gmail.com', 'Lab Explorer');
        
        return $mail;
    }
    
    /**
     * Enviar correo a un administrador sobre la moderación
     */
    private function enviarCorreoAdmin($email_admin, $nombre_admin, $datos_pub, $estado, $razon = null) {
        if ($estado === 'publicado') {
            $asunto = "Publicacion Aprobada Automaticamente - Lab-Explorer";
            $color = "#28a745";
            $icono = "✅";
            $titulo = "Publicación Aprobada";
            $mensaje_principal = "El sistema de moderación automática ha aprobado una nueva publicación.";
        } else if ($estado === 'rechazada') {
            $asunto = "Publicacion Rechazada Automaticamente - Lab-Explorer";
            $color = "#dc3545";
            $icono = "❌";
            $titulo = "Publicación Rechazada";
            $mensaje_principal = "El sistema de moderación automática ha rechazado una publicación.";
        } else {
            return; // No enviar para otros estados
        }
        
        $mensaje_html = "
            <html>
            <head>
                <style>
                    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                    .container { max-width: 600px; margin: 0 auto; padding: 20px; }
                    .header { background-color: {$color}; color: white; padding: 20px; text-align: center; }
                    .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
                    .info-box { background-color: white; padding: 15px; margin: 15px 0; border-left: 4px solid {$color}; }
                    .footer { text-align: center; padding: 20px; font-size: 12px; color: #777; }
                    .button { display: inline-block; padding: 10px 20px; background-color: {$color}; color: white; text-decoration: none; border-radius: 5px; margin-top: 15px; }
                </style>
            </head>
            <body>
                <div class='container'>
                    <div class='header'>
                        <h1>{$icono} {$titulo}</h1>
                    </div>
                    <div class='content'>
                        <p>Hola <strong>{$nombre_admin}</strong>,</p>
                        <p>{$mensaje_principal}</p>
                        
                        <div class='info-box'>
                            <p><strong>Título:</strong> {$datos_pub['titulo']}</p>
                            <p><strong>Publicador:</strong> {$datos_pub['publicador_nombre']}</p>
                            <p><strong>Email:</strong> {$datos_pub['publicador_email']}</p>
                            <p><strong>Estado:</strong> " . strtoupper($estado) . "</p>
                        </div>";
        
        if ($razon) {
            $mensaje_html .= "
                        <div class='info-box' style='background-color: #fff3cd; border-left-color: #ffc107;'>
                            <p><strong>Motivo del rechazo:</strong></p>
                            <p>{$razon}</p>
                        </div>";
        }
        
        $mensaje_html .= "
                        <p style='text-align: center;'>
                            <a href='http://localhost/Lab/forms/admins/gestionar-publicaciones.php' class='button'>Ver Panel de Publicaciones</a>
                        </p>
                    </div>
                    <div class='footer'>
                        <p>Este es un mensaje automático del sistema de moderación de Lab-Explorer.</p>
                        <p>© 2025 Lab-Explorer - Plataforma Académica</p>
                    </div>
                </div>
            </body>
            </html>
        ";
        
        try {
            // Configurar PHPMailer
            $mail = $this->configurarPHPMailer();
            $mail->addAddress($email_admin, $nombre_admin);
            $mail->Subject = $asunto;
            $mail->isHTML(true);
            $mail->Body = $mensaje_html;
            $mail->AltBody = strip_tags($mensaje_html);
            
            // Enviar
            $enviado = $mail->send();
            
            // Logging
            $log_dir = __DIR__ . '/logs';
            if (!file_exists($log_dir)) {
                @mkdir($log_dir, 0777, true);
            }
            
            $log_file = $log_dir . '/email_log.txt';
            $log_msg = date('Y-m-d H:i:s') . " - Envío a ADMIN: {$email_admin}\n";
            $log_msg .= "Asunto: {$asunto}\n";
            $log_msg .= "Resultado: " . ($enviado ? "ÉXITO" : "FALLO") . "\n";
            $log_msg .= "Estado: {$estado}\n";
            $log_msg .= "---\n\n";
            @file_put_contents($log_file, $log_msg, FILE_APPEND);
            
        } catch (Exception $e) {
            // Log del error
            $log_dir = __DIR__ . '/logs';
            if (!file_exists($log_dir)) {
                @mkdir($log_dir, 0777, true);
            }
            
            $log_file = $log_dir . '/email_log.txt';
            $log_msg = date('Y-m-d H:i:s') . " - ERROR enviando a ADMIN: {$email_admin}\n";
            $log_msg .= "Error: " . $e->getMessage() . "\n";
            $log_msg .= "---\n\n";
            @file_put_contents($log_file, $log_msg, FILE_APPEND);
            
            // Guardar HTML para revisión
            $email_file = $log_dir . '/email_admin_error_' . time() . '.html';
            @file_put_contents($email_file, $mensaje_html);
        }
    }
    
    /**
     * Enviar correo electrónico de notificación al publicador
     */
    private function enviarCorreoNotificacion($email, $nombre, $titulo_publicacion, $estado, $razon = null) {
        // Configurar el asunto según el estado
        if ($estado === 'publicado') {
            $asunto = "Tu publicacion ha sido aprobada - Lab-Explorer";
            $mensaje_html = "
                <html>
                <head>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
                        .header { background-color: #28a745; color: white; padding: 20px; text-align: center; }
                        .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
                        .footer { text-align: center; padding: 20px; font-size: 12px; color: #777; }
                        .button { display: inline-block; padding: 10px 20px; background-color: #28a745; color: white; text-decoration: none; border-radius: 5px; }
                    </style>
                </head>
                <body>
                    <div class='container'>
                        <div class='header'>
                            <h1>¡Felicidades!</h1>
                        </div>
                        <div class='content'>
                            <p>Hola <strong>{$nombre}</strong>,</p>
                            <p>Tenemos excelentes noticias. Tu publicación ha sido aprobada y ya está disponible en Lab-Explorer.</p>
                            <p><strong>Título de la publicación:</strong> {$titulo_publicacion}</p>
                            <p>Tu contenido académico ahora está visible para toda la comunidad.</p>
                            <p style='text-align: center; margin-top: 30px;'>
                                <a href='http://localhost/Lab/index.php' class='button'>Ver Publicación</a>
                            </p>
                        </div>
                        <div class='footer'>
                            <p>Este es un mensaje automático del sistema de moderación de Lab-Explorer.</p>
                            <p>© 2025 Lab-Explorer - Plataforma Académica</p>
                        </div>
                    </div>
                </body>
                </html>
            ";
        } else if ($estado === 'rechazada') {
            $asunto = "Tu publicacion requiere revision - Lab-Explorer";
            $mensaje_html = "
                <html>
                <head>
                    <style>
                        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
                        .header { background-color: #dc3545; color: white; padding: 20px; text-align: center; }
                        .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
                        .footer { text-align: center; padding: 20px; font-size: 12px; color: #777; }
                        .reason-box { background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; }
                    </style>
                </head>
                <body>
                    <div class='container'>
                        <div class='header'>
                            <h1>Publicación No Aprobada</h1>
                        </div>
                        <div class='content'>
                            <p>Hola <strong>{$nombre}</strong>,</p>
                            <p>Lamentamos informarte que tu publicación no ha sido aprobada en este momento.</p>
                            <p><strong>Título de la publicación:</strong> {$titulo_publicacion}</p>
                            <div class='reason-box'>
                                <strong>Motivo:</strong><br>
                                {$razon}
                            </div>
                            <p>Te invitamos a revisar el contenido y volver a enviarlo cumpliendo con nuestras políticas de publicación.</p>
                        </div>
                        <div class='footer'>
                            <p>Este es un mensaje automático del sistema de moderación de Lab-Explorer.</p>
                            <p>© 2025 Lab-Explorer - Plataforma Académica</p>
                        </div>
                    </div>
                </body>
                </html>
            ";
        } else {
            // Para estado 'en_revision' u otros
            return; // No enviar correo
        }
        
        // Configurar headers para HTML
        $headers = "MIME-Version: 1.0" . "\r\n";
        $headers .= "Content-type:text/html;charset=UTF-8" . "\r\n";
        $headers .= "From: Lab-Explorer <noreply@lab-explorer.com>" . "\r\n";
        
        // Intentar enviar el correo
        $enviado = @mail($email, $asunto, $mensaje_html, $headers);
        
        // Logging para debugging
        $log_dir = __DIR__ . '/logs';
        if (!file_exists($log_dir)) {
            @mkdir($log_dir, 0777, true);
        }
        
        // Guardar log del intento de envío
        $log_file = $log_dir . '/email_log.txt';
        $log_msg = date('Y-m-d H:i:s') . " - Intento de envío a PUBLICADOR: {$email}\n";
        $log_msg .= "Nombre: {$nombre}\n";
        $log_msg .= "Asunto: {$asunto}\n";
        $log_msg .= "Resultado: " . ($enviado ? "ÉXITO" : "FALLO") . "\n";
        $log_msg .= "Estado: {$estado}\n";
        $log_msg .= "Publicación: {$titulo_publicacion}\n";
        $log_msg .= "---\n\n";
        @file_put_contents($log_file, $log_msg, FILE_APPEND);
        
        // Si mail() falla, guardar el correo en un archivo HTML para revisión
        if (!$enviado) {
            $email_file = $log_dir . '/email_publicador_' . time() . '_' . md5($email) . '.html';
            @file_put_contents($email_file, $mensaje_html);
        }
    }
    
    /**
     * Enviar correo electrónico de notificación al publicador
     */
    private function enviarCorreoNotificacion($email, $nombre, $titulo_publicacion, $estado, $razon = null) {
        // Solo enviar para estados publicado y rechazada
        if ($estado !== 'publicado' && $estado !== 'rechazada') {
            return;
        }
        
        // Configurar asunto y mensaje según el estado
        if ($estado === 'publicado') {
            $asunto = "Tu publicacion ha sido aprobada - Lab-Explorer";
            $color = "#28a745";
            $titulo_correo = "¡Felicidades!";
            $mensaje_principal = "Tu publicación ha sido aprobada y ya está disponible en Lab-Explorer.";
        } else {
            $asunto = "Tu publicacion requiere revision - Lab-Explorer";
            $color = "#dc3545";
            $titulo_correo = "Publicación No Aprobada";
            $mensaje_principal = "Lamentamos informarte que tu publicación no ha sido aprobada en este momento.";
        }
        
        // Construir HTML
        $mensaje_html = "
            <html>
            <head>
                <style>
                    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                    .container { max-width: 600px; margin: 0 auto; padding: 20px; }
                    .header { background-color: {$color}; color: white; padding: 20px; text-align: center; }
                    .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
                    .footer { text-align: center; padding: 20px; font-size: 12px; color: #777; }
                    .button { display: inline-block; padding: 10px 20px; background-color: {$color}; color: white; text-decoration: none; border-radius: 5px; }
                    .reason-box { background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; }
                </style>
            </head>
            <body>
                <div class='container'>
                    <div class='header'>
                        <h1>{$titulo_correo}</h1>
                    </div>
                    <div class='content'>
                        <p>Hola <strong>{$nombre}</strong>,</p>
                        <p>{$mensaje_principal}</p>
                        <p><strong>Título de la publicación:</strong> {$titulo_publicacion}</p>";
        
        if ($estado === 'rechazada' && $razon) {
            $mensaje_html .= "
                        <div class='reason-box'>
                            <strong>Motivo:</strong><br>
                            {$razon}
                        </div>
                        <p>Te invitamos a revisar el contenido y volver a enviarlo cumpliendo con nuestras políticas de publicación.</p>";
        } else {
            $mensaje_html .= "
                        <p>Tu contenido académico ahora está visible para toda la comunidad.</p>
                        <p style='text-align: center; margin-top: 30px;'>
                            <a href='http://localhost/Lab/index.php' class='button'>Ver Publicación</a>
                        </p>";
        }
        
        $mensaje_html .= "
                    </div>
                    <div class='footer'>
                        <p>Este es un mensaje automático del sistema de moderación de Lab-Explorer.</p>
                        <p>© 2025 Lab-Explorer - Plataforma Académica</p>
                    </div>
                </div>
            </body>
            </html>
        ";
        
        try {
            // Configurar PHPMailer
            $mail = $this->configurarPHPMailer();
            $mail->addAddress($email, $nombre);
            $mail->Subject = $asunto;
            $mail->isHTML(true);
            $mail->Body = $mensaje_html;
            $mail->AltBody = strip_tags($mensaje_html);
            
            // Enviar
            $enviado = $mail->send();
            
            // Logging
            $log_dir = __DIR__ . '/logs';
            if (!file_exists($log_dir)) {
                @mkdir($log_dir, 0777, true);
            }
            
            $log_file = $log_dir . '/email_log.txt';
            $log_msg = date('Y-m-d H:i:s') . " - Envío a PUBLICADOR: {$email}\n";
            $log_msg .= "Nombre: {$nombre}\n";
            $log_msg .= "Asunto: {$asunto}\n";
            $log_msg .= "Resultado: " . ($enviado ? "ÉXITO" : "FALLO") . "\n";
            $log_msg .= "Estado: {$estado}\n";
            $log_msg .= "Publicación: {$titulo_publicacion}\n";
            $log_msg .= "---\n\n";
            @file_put_contents($log_file, $log_msg, FILE_APPEND);
            
        } catch (Exception $e) {
            // Log del error
            $log_dir = __DIR__ . '/logs';
            if (!file_exists($log_dir)) {
                @mkdir($log_dir, 0777, true);
            }
            
            $log_file = $log_dir . '/logs/email_log.txt';
            $log_msg = date('Y-m-d H:i:s') . " - ERROR enviando a PUBLICADOR: {$email}\n";
            $log_msg .= "Error: " . $e->getMessage() . "\n";
            $log_msg .= "---\n\n";
            @file_put_contents($log_file, $log_msg, FILE_APPEND);
            
            // Guardar HTML para revisión
            $email_file = $log_dir . '/email_publicador_error_' . time() . '.html';
            @file_put_contents($email_file, $mensaje_html);
        }
    }
    
    /**
     * Agregar palabra prohibida personalizada
     */
    public function agregarPalabraProhibida($palabra) {
        if (!in_array(strtolower($palabra), array_map('strtolower', $this->palabras_prohibidas))) {
            $this->palabras_prohibidas[] = strtolower($palabra);
        }
    }
}

?>
